<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  
  <title>TransformerHardwareFriendlyAccelerator_4</title>
  <meta name="author" content="liangshuang">
  <meta name="description" content="liangshuang personal website">
  
  
  <meta property="og:title" content="TransformerHardwareFriendlyAccelerator_4"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="liangshuang website"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="liangshuang website" type="application/atom+xml">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <a href="/" class="back black-color">
    <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M2 30 L30 2 M30 30 L2 2"></path>
    </svg>
  </a>
  
    <div class="description">
      &nbsp;liangshuang
    </div>
    
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        TransformerHardwareFriendlyAccelerator_4
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2023-06-02T05:38:15.000Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2023-06-02
</time>





    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/tags/Ttransformerç¡¬ä»¶åŠ é€Ÿ-trans-fat/">Ttransformerç¡¬ä»¶åŠ é€Ÿ_trans-fat</a>


    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#trans-fat"><span class="toc-text">trans-fat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Instructions"><span class="toc-text">Instructions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependancies"><span class="toc-text">Dependancies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Building"><span class="toc-text">Building</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Running"><span class="toc-text">Running</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Optimization-Versions"><span class="toc-text">Optimization Versions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#v0"><span class="toc-text">v0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#v1"><span class="toc-text">v1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#v2"><span class="toc-text">v2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#v3"><span class="toc-text">v3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Results"><span class="toc-text">Results</span></a></li></ol></li></ol>
    
    <div class="picture-container">
      
    </div>
    <h1 id="trans-fat"><a href="#trans-fat" class="headerlink" title="trans-fat"></a>trans-fat</h1><p>An FPGA Accelerator for Transformer Inference</p>
<p>We accelerated a BERT layer across two FPGAs, partitioned into four pipeline stages. We conduct three levels of optimization using Vitis HLS and report runtimes. The accelerator implements a transformer layer of standard BERT size, with a sequence length of 128 (which can be modified).</p>
<h2 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h2><p>This repository is designed to run on a host node with at least two Xilinx u200s. The instructions provided are specific to the the Pitt CRC fpga-n0 node, however, they may be adapted as neded for other nodes.</p>
<h3 id="Dependancies"><a href="#Dependancies" class="headerlink" title="Dependancies"></a>Dependancies</h3><p>The required dependancies can be loaded using the following commands.</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module load xilinx/vitis/2020.2</span><br><span class="line">module load libfaketime</span><br><span class="line">source /opt/xilinx/xrt/setup.sh</span><br></pre></td></tr></tbody></table></figure>
<p>ğŸ”´ğŸŸ¢ <em><strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37201243/article/details/129632603">module</a>:æœªæ‰¾åˆ°å‘½ä»¤</strong></em></p>
<blockquote>
<ol>
<li><p>å®‰è£…åŒ…ç®¡ç†å·¥å…·moduleï¼ŒğŸ”µè®°å¾—è”ç½‘ï¼ï¼ï¼</p>
   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install environment-modules</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>å¯¹ module å·¥å…·è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–</p>
   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/modules/init</span><br><span class="line">ls</span><br><span class="line">source /usr/share/modules/init/bash</span><br></pre></td></tr></tbody></table></figure>
<p>   ğŸ”´ğŸŸ¢ <em><strong>åˆå§‹åŒ–æŠ¥é”™</strong></em></p>
<ul>
<li>bash:/user/bin/tclsh:æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•</li>
<li>bash:export:_moduleraw:ä¸æ˜¯å‡½æ•°</li>
<li>bash:export:module:ä¸æ˜¯å‡½æ•°</li>
</ul>
<p>   ğŸ”µä¸‹è½½tcl,æ­¤é”™è¯¯ä¸å†å‡ºç°ã€‚<br>   </p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install tcl </span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>é¿å…æ¯æ¬¡æ‰“å¼€ç»ˆç«¯çš„æ—¶å€™éƒ½éœ€è¦source /usr/share/modules/init/bash,éœ€è¦æŠŠè¯¥å‘½ä»¤æ·»åŠ åˆ°/etc/profileæ–‡ä»¶å½“ä¸­</p>
<ul>
<li>æ‰“å¼€/etc/profileæ–‡ä»¶ï¼š   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vim</span><br><span class="line">sudo vim /etc/profile</span><br></pre></td></tr></tbody></table></figure></li>
<li>åœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥ä»¥ä¸‹è¯­å¥ï¼š   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [ -f /usr/share/modules/init/bash ]; then</span><br><span class="line">    source /usr/share/modules/init/bash</span><br><span class="line">fi</span><br></pre></td></tr></tbody></table></figure></li>
<li>åœ¨ç¼–è¾‘å®Œ /etc/profile æ–‡ä»¶åï¼Œä½ å¯ä»¥æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ <strong>â€œEscâ€ é”®é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œç„¶åè¾“å…¥ :wqï¼ˆæ„å‘³ç€â€writeâ€å’Œâ€quitâ€ï¼‰ä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶</strong>ã€‚</li>
</ul>
</li>
<li><p>é…ç½®Module</p>
   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $MODULEPATH</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>æ·»åŠ ç¯å¢ƒå˜é‡<br>  å¦‚æœåœ¨å®‰è£… Environment Modules åï¼Œè¾“å…¥ module list å‘½ä»¤æ—¶æ˜¾ç¤º â€œmodules: command not foundâ€ï¼Œè¿™å¯èƒ½æ„å‘³ç€ç¯å¢ƒæ¨¡å—çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æœªæ­£ç¡®æ·»åŠ åˆ°ç³»ç»Ÿçš„ PATH ç¯å¢ƒå˜é‡ä¸­ã€‚<br>  ä½ å¯ä»¥å°è¯•æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥è§£å†³è¯¥é—®é¢˜ï¼š</p>
</li>
</ol>
<ul>
<li><p>ç¡®ä¿ Environment Modules å·²æˆåŠŸå®‰è£…ã€‚å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥å…¶æ˜¯å¦å·²å®‰è£…ï¼š</p>
  <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l environment-modules</span><br></pre></td></tr></tbody></table></figure>
<p>  å¦‚æœå®‰è£…æˆåŠŸï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºåŒ…çš„ä¿¡æ¯ã€‚</p>
</li>
<li><p>æ‰“å¼€ç»ˆç«¯ï¼Œå¹¶ç¼–è¾‘ä½ çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>~/.bashrc</code> æˆ– <code>~/.bash_profile</code>ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ <code>.bashrc</code> æ–‡ä»¶ï¼š</p>
 <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/.bashrc</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>ğŸ”µåœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile.d/modules.sh</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>ğŸŒº <em><strong>nanoä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºç¼–è¾‘å™¨:</strong></em><br>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ nano ç¼–è¾‘å™¨æ¥ç¼–è¾‘æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºï¼š</p>
<ul>
<li>åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨é”®ç›˜ä¸Šçš„æ–¹å‘é”®æˆ–é¼ æ ‡æ¥ç§»åŠ¨å…‰æ ‡åˆ°ä½ æƒ³è¦ä¿®æ”¹çš„ä½ç½®ï¼Œå¯¹äºä¿®æ”¹æˆ–æ·»åŠ æ–‡æœ¬ï¼Œè¯·ç›´æ¥åœ¨å…‰æ ‡æ‰€åœ¨ä½ç½®è¿›è¡Œç¼–è¾‘ã€‚</li>
<li>å¦‚æœè¦ä¿å­˜æ–‡ä»¶ï¼Œè¯·æŒ‰ä¸‹ <code>Ctrl + O</code>ï¼ˆå³æŒ‰ä½ Ctrl é”®ï¼Œç„¶åæŒ‰å­—æ¯ â€œOâ€ï¼‰ã€‚</li>
<li>åœ¨åº•éƒ¨çš„æç¤ºç¬¦å¤„ï¼Œä½ å°†çœ‹åˆ° â€œFile Name to Writeâ€ çš„æç¤ºã€‚ç¡®è®¤æ–‡ä»¶åå’Œè·¯å¾„æ­£ç¡®ï¼Œç„¶åæŒ‰ä¸‹ Enter é”®ã€‚</li>
<li>æ–‡ä»¶å°†è¢«ä¿å­˜ï¼Œå¹¶åœ¨åº•éƒ¨çš„æç¤ºç¬¦å¤„æ˜¾ç¤º â€œWroteâ€ å’Œæ–‡ä»¶åã€‚</li>
<li>è¦é€€å‡º nano ç¼–è¾‘å™¨ï¼Œè¯·æŒ‰ä¸‹ <code>Ctrl + X</code>ã€‚</li>
</ul>
<p>å¦‚æœæœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¼–è¾‘å™¨å°†è¯¢é—®æ˜¯å¦è¦ä¿å­˜æ›´æ”¹ã€‚åœ¨æç¤ºä¸­ï¼Œé€‰æ‹© â€œYâ€ï¼ˆæ˜¯ï¼‰æ¥ä¿å­˜æ›´æ”¹å¹¶é€€å‡ºï¼Œæˆ–é€‰æ‹© â€œNâ€ï¼ˆå¦ï¼‰æ¥æ”¾å¼ƒæ›´æ”¹å¹¶é€€å‡ºã€‚</p>
</li>
<li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
 <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<ol start="6">
<li>å…¶ä»–è¡¥å……</li>
</ol>
<ul>
<li><p>ğŸŒº <em><strong>vimä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºç¼–è¾‘å™¨:</strong></em><br>åœ¨ Vim ç¼–è¾‘å™¨ä¸­ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é€€å‡ºï¼š</p>
<ul>
<li>æŒ‰ä¸‹ Esc é”®ï¼Œä»¥ç¡®ä¿å¤„äºå‘½ä»¤æ¨¡å¼ï¼ˆCommand modeï¼‰ã€‚</li>
<li>è¾“å…¥ :wqâ€™ï¼Œç„¶åæŒ‰ä¸‹ Enter é”®ã€‚è¿™å°†ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºç¼–è¾‘å™¨ã€‚å¦‚æœä½ åªæƒ³é€€å‡ºè€Œä¸ä¿å­˜æ–‡ä»¶æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ :q! å‘½ä»¤ã€‚</li>
</ul>
<p>Vim å°†æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯ï¼Œç¡®è®¤æ–‡ä»¶å·²ä¿å­˜ï¼ˆå¦‚æœåº”ç”¨çš„è¯ï¼‰ï¼Œç„¶åé€€å‡ºåˆ°ç»ˆç«¯ã€‚</p>
</li>
<li><p>ğŸŒº <em><strong>vimä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºç¼–è¾‘å™¨:</strong></em><br>åœ¨ Emacs ç¼–è¾‘å™¨ä¸­ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é€€å‡ºï¼š</p>
<ul>
<li>æŒ‰ä¸‹ Ctrl + x é”®ï¼Œç„¶åæŒ‰ä¸‹ Ctrl + c é”®ã€‚è¿™å°†è§¦å‘ Emacs çš„é€€å‡ºå‘½ä»¤ã€‚</li>
<li>Emacs å°†æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯ï¼Œè¯¢é—®ä½ æ˜¯å¦è¦ä¿å­˜æ–‡ä»¶æ›´æ”¹ã€‚æŒ‰ä¸‹ y é”®æ¥ä¿å­˜æ›´æ”¹ï¼Œæˆ–æŒ‰ä¸‹ n é”®æ¥æ”¾å¼ƒæ›´æ”¹ã€‚</li>
<li>å¦‚æœé€‰æ‹©ä¿å­˜æ›´æ”¹ï¼ŒEmacs å°†è¦æ±‚ä½ æŒ‡å®šä¿å­˜çš„æ–‡ä»¶åæˆ–ç¡®è®¤ç°æœ‰æ–‡ä»¶åã€‚</li>
</ul>
<p>å®Œæˆä¿å­˜æˆ–æ”¾å¼ƒæ›´æ”¹åï¼ŒEmacs å°†é€€å‡ºå¹¶è¿”å›åˆ°ç»ˆç«¯ã€‚</p>
</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://102no.com/2019/11/26/libfaketime-use/">æ—¶é—´æµ‹è¯•ç¥å™¨libfaketimeçš„ä½¿ç”¨</a></p>
<blockquote>
<p>libfaketimeé™„å¸¦ä¸€ä¸ªåä¸ºâ€œfaketimeâ€çš„å‘½ä»¤è¡ŒåŒ…è£…ï¼Œæ˜“äºä½¿ç”¨ï¼Œä½†ä¸å…¬å¼€libfaketimeçš„æ‰€æœ‰åŠŸèƒ½ã€‚</p>
<ol>
<li>å®‰è£…ä½¿ç”¨   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update -y</span><br><span class="line">sudo apt-get install -y faketime</span><br></pre></td></tr></tbody></table></figure></li>
<li>ä½¿ç”¨faketimeå‘½ä»¤<ul>
<li>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ—¶é—´   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date</span><br><span class="line">2019å¹´ 11æœˆ 26æ—¥ æ˜ŸæœŸäºŒ 14:46:25 CST</span><br></pre></td></tr></tbody></table></figure></li>
<li>ç›´æ¥æŒ‡å®šæ—¶é—´ï¼š   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">faketime '2018-03-27 21:04:52' date</span><br><span class="line">2018å¹´ 03æœˆ 27æ—¥ æ˜ŸæœŸäºŒ 21:04:52 CST</span><br></pre></td></tr></tbody></table></figure></li>
<li>æŒ‡å®šæ—¶é—´ä»10å¤©å‰å¼€å§‹:   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">faketime -f '-10d' date</span><br><span class="line">2019å¹´ 11æœˆ 16æ—¥ æ˜ŸæœŸå…­ 14:48:43 CST</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ol>
</blockquote>
<p>Ubuntuä¸Šå®‰è£…libfaketime</p>
<blockquote>
<p>è¦åœ¨Ubuntuä¸Šå®‰è£…libfaketimeï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š</p>
<ol>
<li>æ‰“å¼€ç»ˆç«¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¿«æ·é”® Ctrl+Alt+T åœ¨Ubuntuä¸Šæ‰“å¼€ç»ˆç«¯ã€‚</li>
<li>æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è·å–æœ€æ–°çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼š<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></tbody></table></figure></li>
<li>å®‰è£…libfaketimeè½¯ä»¶åŒ…ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…libfaketimeï¼š<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libfaketime</span><br></pre></td></tr></tbody></table></figure></li>
<li>æŸ¥æ‰¾åº“æ–‡ä»¶è·¯å¾„ï¼šlibfaketimeçš„åº“æ–‡ä»¶é€šå¸¸ä½äºç³»ç»Ÿçš„æ ‡å‡†åº“ç›®å½•ä¸­ï¼Œä¾‹å¦‚<code>/usr/lib</code>æˆ–<code>/usr/lib64</code>ã€‚æ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥æ‰¾libfaketimeåº“æ–‡ä»¶çš„è·¯å¾„ï¼š<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L libfaketime</span><br></pre></td></tr></tbody></table></figure>
è¿™å°†åˆ—å‡ºlibfaketimeè½¯ä»¶åŒ…å®‰è£…çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°libfaketimeçš„åº“æ–‡ä»¶è·¯å¾„ã€‚</li>
<li>éªŒè¯å®‰è£…ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯libfaketime&gt; æ˜¯å¦æˆåŠŸå®‰è£…ï¼š<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">faketime --version</span><br></pre></td></tr></tbody></table></figure>
å¦‚æœæˆåŠŸå®‰è£…ï¼Œå°†æ˜¾ç¤ºlibfaketimeçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚<br>è¦ç¡®ä¿æ­£ç¡®å®‰è£…libfaketimeå¹¶æŒ‡å®šæ­£ç¡®çš„åº“è·¯å¾„ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š</li>
<li>è®¾ç½®LD_PRELOADç¯å¢ƒå˜é‡ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œå¹¶ä½¿ç”¨<code>export</code>å‘½ä»¤è®¾ç½®<code>LD_PRELOAD</code>ç¯å¢ƒå˜é‡ï¼Œå°†libfaketimeåº“çš„è·¯å¾„æŒ‡å®šä¸ºå…¶å€¼ï¼š   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=/path/to/libfaketime.so</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å¦‚æœæ–‡ä»¶åä»¥â€™.so.1â€™ç»“å°¾è€Œä¸æ˜¯â€™.soâ€™ï¼Œè¿™è¡¨ç¤ºå®‰è£…çš„æ˜¯libfaketimeçš„å…±äº«åº“çš„ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥çš„åº“æ–‡ä»¶ã€‚</li>
<li>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå…±äº«åº“é€šå¸¸å…·æœ‰ä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·ã€‚ä¾‹å¦‚ï¼Œlibfaketime.so.1è¡¨ç¤ºlibfaketimeçš„å…±äº«åº“çš„ä¸»ç‰ˆæœ¬å·ä¸º1ã€‚è¿™æ ·çš„å‘½åçº¦å®šå…è®¸åœ¨ä¿æŒä¸»ç‰ˆæœ¬ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œä¿®è®¢å’Œæ›´æ–°ã€‚  <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=/path/to/libfaketime.so.1</span><br></pre></td></tr></tbody></table></figure>
 å°†/path/to/libfaketime.soæ›¿æ¢ä¸ºæ‚¨åœ¨æ­¥éª¤2ä¸­æ‰¾åˆ°çš„libfaketimeåº“æ–‡ä»¶çš„å®é™…è·¯å¾„ã€‚</li>
</ul>
</li>
<li>éªŒè¯è®¾ç½®ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦å·²æ­£ç¡®è®¾ç½®LD_PRELOADç¯å¢ƒå˜é‡ï¼š   <figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $LD_PRELOAD</span><br></pre></td></tr></tbody></table></figure>
   è¿™å°†æ˜¾ç¤ºLD_PRELOADç¯å¢ƒå˜é‡çš„å€¼ï¼Œç¡®ä¿å®ƒæŒ‡å‘libfaketimeåº“çš„è·¯å¾„ã€‚</li>
<li>åŠ è½½<br>libfaketimeæ˜¯ä¸€ä¸ªç”¨æˆ·ç©ºé—´å·¥å…·ï¼Œä¸éœ€è¦åŠ è½½åˆ°å†…æ ¸ä¸­ã€‚å®ƒé€šè¿‡åœ¨ç¨‹åºæ‰§è¡Œæ—¶è¿›è¡ŒåŠ¨æ€é“¾æ¥æ¥å®ç°å¯¹ç¨‹åºæ‰§è¡Œæ—¶é—´çš„ä¿®æ”¹ã€‚</li>
</ol>
</blockquote>
<h3 id="Building"><a href="#Building" class="headerlink" title="Building"></a>Building</h3><p>All building is performed in the <code>fpga/</code> directory. Navigate there and enter the following command.</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">faketime <span class="string">'last year'</span> make all TARGET=&lt;hw, hw_emu, sw_emu&gt; VERSION=&lt;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&gt; PART=&lt;fpga1, fpga2, all&gt; JOBS=&lt;<span class="meta"># of jobs requested&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>If building for hardware the output artifacts will automatically be coppied into <code>/builds/v#/fpga#/</code>.</p>
<h3 id="Running"><a href="#Running" class="headerlink" title="Running"></a>Running</h3><p>To run all enter <code>make test VERSION=&lt;0, 1, 2, 3&gt; PART=all</code> in the <code>fpga/</code> directory.</p>
<p>Individual fpga builds can be run directly using the host and executable in the desired <code>builds/</code> directory.</p>
<h2 id="Optimization-Versions"><a href="#Optimization-Versions" class="headerlink" title="Optimization Versions"></a>Optimization Versions</h2><h3 id="v0"><a href="#v0" class="headerlink" title="v0"></a>v0</h3><ul>
<li>None</li>
</ul>
<h3 id="v1"><a href="#v1" class="headerlink" title="v1"></a>v1</h3><ul>
<li>Linear layer tiling</li>
<li>Buffering of input and output data</li>
<li>Unrolling of multiplication inner loops</li>
</ul>
<h3 id="v2"><a href="#v2" class="headerlink" title="v2"></a>v2</h3><ul>
<li>Transpose A matmul input</li>
<li>Cache line of A.T</li>
<li>Increase tile size in j dimension </li>
<li>Unrolling of computation in attention heads</li>
</ul>
<h3 id="v3"><a href="#v3" class="headerlink" title="v3"></a>v3</h3><ul>
<li>Stream DDR inputs/outputs in linear layers</li>
</ul>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><table align="center">
<thead>
  <tr>
    <th rowspan="2">Version</th>
    <th colspan="3">Latency (ms)</th>
  </tr>
  <tr>
    <th>fpga1</th>
    <th>fpga2</th>
    <th>all</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td align="center">v0</td>
    <td>4723.71</td>
    <td>10950.90</td>
    <td>15676.30</td>
  </tr>
  <tr>
    <td align="center">v1</td>
    <td>274.98</td>
    <td>120.91</td>
    <td>397.45</td>
  </tr>
  <tr>
    <td align="center">v2</td>
    <td>48.36</td>
    <td>95.60</td>
    <td>145.27</td>
  </tr>
  <tr>
    <td align="center">v3</td>
    <td>35.03</td>
    <td>71.76</td>
    <td>110.99</td>
  </tr>
</tbody>
</table>





  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    é¡µé˜…è¯»é‡:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;ãƒ»&nbsp;
    ç«™è®¿é—®é‡:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;ãƒ»&nbsp;
    ç«™è®¿å®¢æ•°:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    
        <style>
        .vcard .vimg{left:0;}
        </style>
        <div id="vcomment" class="vcomment" style="padding:0 6% 0 7%;"></div>
        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
        <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
        <script>
            var GUEST_INFO = ['nick','mail','link'];
            var guest_info = 'nick,mail,link'.split(',').filter(function(item){
                return GUEST_INFO.indexOf(item) > -1
            });
            var notify = 'false' == true;
            var verify = 'false' == true;
            var valine = new Valine();
            valine.init({
                el: '.vcomment',
                notify: notify,
                verify: verify,
                appId: "pXGIlBXFqxXIT3fM1cxcRq8P-gzGzoHsz",
                appKey: "dRRfR7mfIfY3h63LCAla3p7r",
                placeholder: "Just go go",
                pageSize:'10',
                avatar:'mp',
                lang:'zh-cn'
            })
        </script>
    





    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        Â© liangshuang 1999-2023
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="https://github.com/gaoryrt/hexo-theme-pln">
        super cool
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
